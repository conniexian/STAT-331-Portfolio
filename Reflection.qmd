---
title: "STAT 331 Portfolio"
author: "Connie Xian"
format: html 
embed-resources: true
layout: margin-left
editor: visual
execute: 
  eval: false
  echo: true
---

[**My Grade:**]{.underline} I believe my grade equivalent to course work evidenced below to be an A.

[**Learning Objective Evidence:**]{.underline} In the code chunks below, provide code from Lab or Challenge assignments where you believe you have demonstrated proficiency with the specified learning target. Be sure to specify **where** the code came from (e.g., Lab 4 Question 2).

## Working with Data

**WD-1: I can import data from a *variety* of formats (e.g., csv, xlsx, txt, etc.).**

-   `csv` Example 1

```{r}
#| label: wd-1-csv-1

# Lab 2 Question 1
surveys <- read_csv(here::here("Week 2", "surveys.csv"))
```

-   `csv` Example 2

```{r}
#| label: wd-1-csv-2

# Lab 3 Question 2
teacher_evals <- read_csv(here::here("Week 3", "teacher_evals.csv"))
```

-   `xlsx`

```{r}
#| label: wd-1-xlsx

# Check-In 2.2
agesxl <- read_xlsx(path = here::here("Week 2", "Check-ins", "Ages_Data", "ages.xlsx"),
                    sheet = "ages")
```

**WD-2: I can select necessary columns from a dataset.**

-   Example selecting specified columns

```{r}
#| label: wd-2-ex-1

# Lab 3 Question 7
instructors <- teacher_evals_clean |> 
  select(teacher_id, academic_degree, seniority, sex) |> 
  distinct(teacher_id, .keep_all = TRUE)
```

-   Example removing specified columns

```{r}
#| label: wd-2-ex-2

# Lab 5 - The Witnesses (Revised for Portfolio)
# Searching for Witness 1
person |> 
  filter(address_street_name == "Northwestern Dr") |>  # Find first witness
  slice_max(address_number) |> 
  left_join(y = interview,                             # Search for interview by person_id
            by = join_by(id == person_id)) |>          
  select(-(id:ssn))  |>                                # View interview transcript
  kable(col.names = "Clue #2")
# Searching for Witness 2
person |> 
  filter(address_street_name == "Franklin Ave",        # Find second witness
         str_detect(name,
                    pattern = "Annabel")) |> 
  left_join(y = interview,                             # Search for interview by person_id
            by = join_by(id == person_id)) |>          
  select(transcript)  |>                               # View interview transcript
  kable(col.names = "Clue #3")
```

-   Example selecting columns based on logical values (e.g., `starts_with()`, `ends_with()`, `contains()`, `where()`)

```{r}
#| label: wd-2-ex-3

# Lab 4 Revisions Question 7 (Revised for Portfolio)

colors <- colorRampPalette(RColorBrewer::brewer.pal(7, "Accent"))(10) # color palette

ca_childcare |> 
  select(census_region,
         county_name,
         study_year,
         starts_with("mc_")) |> 
  pivot_longer(cols = c(mc_infant, mc_toddler, mc_preschool),
               names_to = "age_group",
               values_to = "median_price") |>
  mutate(age_group = fct_recode(age_group,
                              "Infant" = "mc_infant",
                              "Toddler" = "mc_toddler",
                              "Preschool" = "mc_preschool"),
         age_group = fct_relevel(age_group, 
                                "Infant",
                                "Toddler",
                                "Preschool"),
         census_region = fct_reorder2(.f = census_region,
                                     .x = study_year,
                                     .y = median_price,
                                     .desc = TRUE)) |> 
  ggplot(mapping = aes(x = study_year, y = median_price, color = census_region)) +
  geom_point(size = 0.5) +
  geom_smooth(linewidth = 0.5) +
  facet_wrap(vars(age_group)) +
  theme_bw() +
  theme(aspect.ratio = 1,
        axis.text.x = element_text(size = 6),
        axis.text.y = element_text(size = 6),
        title = element_text(size = 8),
        legend.title = element_text(size = 10),
        legend.key.size = unit(0.4, "cm")) +
  scale_x_continuous(n.breaks = 7) +
  scale_y_continuous(limits = c(100,500)) +
  scale_color_manual(values = colors,
                     labels = c("San Francisco Bay Area",
                                "Orange County",
                                "Los Angeles County",
                                "North San Joaquin Valley",
                                "Central Coast",
                                "Inland Empire",
                                "Superior California",
                                "South San Joaquin Valley",
                                "San Diego - Imperial",
                                "North Coast")) +
  labs(x = "Study Year",
       y = NULL,
       title = "Weekly Median Price for Center-Based Childcare ($)",
       color = "Calfornia Region") 
```

**WD-3: I can filter rows from a dataframe for a *variety* of data types (e.g., numeric, integer, character, factor, date).**

-   Numeric Example 1

```{r}
#| label: wd-3-numeric-ex-1

# Lab 3 Question 5
teacher_evals_clean <- teacher_evals |>
  rename(sex = gender) |>
  filter(no_participants > 10) |>
  mutate(across(.cols = c(teacher_id, question_no, academic_degree, sex),
                .fns = ~ as.factor(.x))) |>
  select(course_id,
         teacher_id,
         question_no,
         no_participants,
         resp_share,
         SET_score_avg,
         percent_failed_cur,
         academic_degree,
         seniority,
         sex)
```

-   Numeric Example 2

```{r}
#| label: wd-3-numeric-ex-2

# Lab 3 - Question 12
teacher_evals_clean |> 
  group_by(teacher_id, seniority, sex) |> 
  filter(academic_degree %in% c("prof", "dr")) |> 
  summarize(resp_rate = mean(resp_share),
            .groups = "drop") |> 
  filter(resp_rate == max(resp_rate) | 
         resp_rate == min(resp_rate)) |>
  arrange(resp_rate) |>
  kable()
```

-   Character Example 1 (any context)

```{r}
#| label: wd-3-character

# Lab 3 - Question 12

# Feedback: I would recommend using the %in% operator instead of the or!
# Revision Reflection: Initially, I used an | operator to filter the data.
# However, by using the %in% operator, I can increase the efficiency of my 
# code. Using the %in% operator also makes my code more easily readable, 
# since it is more clear how the data is being filtered now.

teacher_evals_clean |> 
  group_by(teacher_id, seniority, sex) |> 
  filter(academic_degree %in% c("prof", "dr")) |> 
  summarize(resp_rate = mean(resp_share),
            .groups = "drop") |> 
  filter(resp_rate == max(resp_rate) | 
         resp_rate == min(resp_rate)) |>
  arrange(resp_rate) |>
  kable()
```

-   Character Example 2 (example must use functions from **stringr**)

```{r}
#| label: wd-3-string

# Lab 5 - Inspecting the Crime Scene (Revised for Portfolio)
get_fit_now_member |>
  filter(membership_status == "gold",                  # Find all gold members with a membership
         str_sub(id, start = 1, end = 3) == "48Z") |>  # number that start with 48Z
  left_join(person,
            join_by(person_id == id, name)) |>         # Use person data to find associated license
  left_join(drivers_license,                           # Use license data to find suspect with plate
            join_by(license_id == id))  |>             # number that includes "H42"
  filter(str_detect(plate_number,
                    pattern = "H42W")) |> 
  left_join(get_fit_now_check_in,                      # Check that date matches statement from  
            join_by(id == membership_id)) |>           # second witness
  filter(ymd(check_in_date) == "2018-01-09") |> 
  left_join(interview,                                     
            join_by(person_id)) |>                     # Retrieve suspect interview
  select(transcript)   |>                              # View interview transcript
  kable(col.names = "Clue #4")
```

-   Date (example must use functions from **lubridate**)

```{r}
#| label: wd-3-date

# Lab 5 - Inspecting the Crime Scene (Revised for Portfolio)
get_fit_now_member |>
  filter(membership_status == "gold",                  # Find all gold members with a membership
         str_sub(id, start = 1, end = 3) == "48Z") |>  # number that start with 48Z
  left_join(person,
            join_by(person_id == id, name)) |>         # Use person data to find associated license
  left_join(drivers_license,                           # Use license data to find suspect with plate
            join_by(license_id == id))  |>             # number that includes "H42"
  filter(str_detect(plate_number,
                    pattern = "H42W")) |> 
  left_join(get_fit_now_check_in,                      # Check that date matches statement from  
            join_by(id == membership_id)) |>           # second witness
  filter(ymd(check_in_date) == "2018-01-09") |> 
  left_join(interview,                                     
            join_by(person_id)) |>                     # Retrieve suspect interview
  select(transcript)   |>                              # View interview transcript
  kable(col.names = "Clue #4")
```

**WD-4: I can modify existing variables and create new variables in a dataframe for a *variety* of data types (e.g., numeric, integer, character, factor, date).**

-   Numeric Example 1

```{r}
#| label: wd-4-numeric-ex-1

# Challenge 3 Question 1
teacher_evals_compare <- teacher_evals |> 
  filter(question_no == 903) |> 
  mutate(SET_level = if_else(SET_score_avg >= 4,
                             "excellent",
                             "standard"),
         sen_level = case_when(seniority <= 4                 ~ "junior",
                               seniority > 4 & seniority <= 8 ~ "senior",
                               seniority > 8                  ~ "very senior")) |> 
  select(course_id,
         SET_level,
         sen_level)
```

-   Numeric Example 2

```{r}
#| label: wd-4-numeric-ex-2

# Lab 3 Question 5
teacher_evals_clean <- teacher_evals |>
  rename(sex = gender) |>
  filter(no_participants > 10) |>
  mutate(across(.cols = c(teacher_id, question_no, academic_degree, sex),
                .fns = ~ as.factor(.x))) |>
  select(course_id,
         teacher_id,
         question_no,
         no_participants,
         resp_share,
         SET_score_avg,
         percent_failed_cur,
         academic_degree,
         seniority,
         sex)
```

-   Factor Example 1 (renaming levels)

```{r}
#| label: wd-4-factor-ex-1

# Lab 4 Revisions Question 7 (Revised for Portfolio)

colors <- colorRampPalette(RColorBrewer::brewer.pal(7, "Accent"))(10) # color palette

ca_childcare |> 
  select(census_region,
         county_name,
         study_year,
         starts_with("mc_")) |> 
  pivot_longer(cols = c(mc_infant, mc_toddler, mc_preschool),
               names_to = "age_group",
               values_to = "median_price") |>
  mutate(age_group = fct_recode(age_group,
                              "Infant" = "mc_infant",
                              "Toddler" = "mc_toddler",
                              "Preschool" = "mc_preschool"),
         age_group = fct_relevel(age_group, 
                                "Infant",
                                "Toddler",
                                "Preschool"),
         census_region = fct_reorder2(.f = census_region,
                                     .x = study_year,
                                     .y = median_price,
                                     .desc = TRUE)) |> 
  ggplot(mapping = aes(x = study_year, y = median_price, color = census_region)) +
  geom_point(size = 0.5) +
  geom_smooth(linewidth = 0.5) +
  facet_wrap(vars(age_group)) +
  theme_bw() +
  theme(aspect.ratio = 1,
        axis.text.x = element_text(size = 6),
        axis.text.y = element_text(size = 6),
        title = element_text(size = 8),
        legend.title = element_text(size = 10),
        legend.key.size = unit(0.4, "cm")) +
  scale_x_continuous(n.breaks = 7) +
  scale_y_continuous(limits = c(100,500)) +
  scale_color_manual(values = colors,
                     labels = c("San Francisco Bay Area",
                                "Orange County",
                                "Los Angeles County",
                                "North San Joaquin Valley",
                                "Central Coast",
                                "Inland Empire",
                                "Superior California",
                                "South San Joaquin Valley",
                                "San Diego - Imperial",
                                "North Coast")) +
  labs(x = "Study Year",
       y = NULL,
       title = "Weekly Median Price for Center-Based Childcare ($)",
       color = "Calfornia Region") 
```

-   Factor Example 2 (reordering levels)

```{r}
#| label: wd-4-factor-ex-2

# Lab 4 Revisions Question 7

# Feedback: The fct_reorder2() function is what you want to reorder the legend!
# Revision Reflection (section): By using the fct_reorder2(), I can reorder the facets based off of TWO variables in the same way that the scatter plot uses both the x and y variables to plot points. Using this function over fct_reorder() is a better representation of the data being presented in the graph. ...

colors <- colorRampPalette(RColorBrewer::brewer.pal(7, "Accent"))(10)    # color palette

ca_childcare |> 
  select(census_region,
         county_name,
         study_year,
         Infant = mc_infant,
         Toddler = mc_toddler,
         Preschool = mc_preschool) |> 
  pivot_longer(cols = c(Infant, Toddler, Preschool),
               names_to = "age_group",
               values_to = "median_price") |>
  mutate(age_group = fct(age_group,
                         levels = c("Infant", "Toddler", "Preschool")),
         census_region = fct_reorder2(.f = census_region,
                                     .x = study_year,
                                     .y = median_price,
                                     .desc = TRUE)) |> 
  ggplot(mapping = aes(x = study_year, y = median_price, color = census_region)) +
  geom_point(size = 0.5) +
  geom_smooth(linewidth = 0.5) +
  facet_wrap(vars(age_group)) +
  theme_bw() +
  theme(aspect.ratio = 1,
        axis.text.x = element_text(size = 6),
        axis.text.y = element_text(size = 6),
        title = element_text(size = 8),
        legend.title = element_text(size = 10),
        legend.key.size = unit(0.4, "cm")) +
  scale_x_continuous(n.breaks = 7) +
  scale_y_continuous(limits = c(100,500)) +
  scale_color_manual(values = colors,
                     labels = c("San Francisco Bay Area",
                                "Orange County",
                                "Los Angeles County",
                                "North San Joaquin Valley",
                                "Central Coast",
                                "Inland Empire",
                                "Superior California",
                                "South San Joaquin Valley",
                                "San Diego - Imperial",
                                "North Coast")) +
  labs(x = "Study Year",
       y = NULL,
       title = "Weekly Median Price for Center-Based Childcare ($)",
       color = "Calfornia Region")
```

-   Character (example must use functions from **stringr**)

```{r}
#| label: wd-4-string

# Lab 5 - Inspecting the Crime Scene (Revised for Portfolio)
get_fit_now_member |>
  mutate(id_starting_3 = str_sub(id,                   # Find all gold members with a membership
                                 start = 1,            # number that start with 48Z
                                 end = 3)) |> 
  filter(membership_status == "gold",                  
         id_starting_3 == "48Z") |>                    
  left_join(person,                                    # Use person data to find associated license
            join_by(person_id == id, name)) |>        
  left_join(drivers_license,                           # Use license data to find suspect with plate
            join_by(license_id == id))  |>             # number that includes "H42"
  filter(str_detect(plate_number,
                    pattern = "H42W")) |> 
  left_join(get_fit_now_check_in,                      # Check that date matches statement from  
            join_by(id == membership_id)) |>           # second witness
 ilter(ymd(check_in_date) == "2018-01-09") |> 
  left_join(interview,                                     
            join_by(person_id)) |>                     # Retrieve suspect interview
  select(transcript)   |>                              # View interview transcript
  kable(col.names = "Clue #4")
```

-   Date (example must use functions from **lubridate**)

```{r}
#| label: wd-4-date

# Lab 5 - Inspecting the Crime Scene (Revised for Portfolio)
get_fit_now_member |>
  filter(membership_status == "gold",                  # Find all gold members with a membership
         str_sub(id, start = 1, end = 3) == "48Z") |>  # number that start with 48Z
  left_join(person,
            join_by(person_id == id, name)) |>         # Use person data to find associated license
  left_join(drivers_license,                           # Use license data to find suspect with plate
            join_by(license_id == id))  |>             # number that includes "H42"
  filter(str_detect(plate_number,
                    pattern = "H42W")) |> 
  left_join(get_fit_now_check_in,                      # Check that date matches statement from  
            join_by(id == membership_id)) |>           # second witness
  mutate(check_in_date = ymd(check_in_date)) |> 
  filter(check_in_date == "2018-01-09") |> 
  left_join(interview,                                     
            join_by(person_id)) |>                     # Retrieve suspect interview
  select(transcript)   |>                              # View interview transcript
  kable(col.names = "Clue #4")
```

**WD-5: I can use mutating joins to combine multiple dataframes.**

-   `left_join()` Example 1

```{r}
#| label: wd-5-left-ex-1

# Lab 5 - Inspecting the Crime Scene (Revised for Portfolio)
get_fit_now_member |>
  filter(membership_status == "gold",                  # Find all gold members with a membership
         str_sub(id, start = 1, end = 3) == "48Z") |>  # number that start with 48Z
  left_join(person,
            join_by(person_id == id, name)) |>         # Use person data to find associated license
  left_join(drivers_license,                           # Use license data to find suspect with plate
            join_by(license_id == id))  |>             # number that includes "H42"
  filter(str_detect(plate_number,
                    pattern = "H42W")) |> 
  left_join(get_fit_now_check_in,                      # Check that date matches statement from  
            join_by(id == membership_id)) |>           # second witness
  filter(ymd(check_in_date) == "2018-01-09") |> 
  left_join(interview,                                     
            join_by(person_id)) |>                     # Retrieve suspect interview
  select(transcript)   |>                              # View interview transcript
  kable(col.names = "Clue #4")
```

-   `right_join()` Example 1

```{r}
#| label: wd-5-right

# Lab 5 - Investigating the Witnesses (Revised for Portfolio)
person |> 
  right_join(y = interview,                             
             by = join_by(id == person_id)) |>
  filter(address_street_name == "Northwestern Dr" &
           address_number == max(address_number) |
         address_street_name == "Franklin Ave" &
           str_detect(name, pattern = "Annabel"))  |> 
  select(transcript)  |>                              
  kable(col.names = "Clue #2 & Clue #3")
```

-   `left_join()` **or** `right_join()` Example 2

```{r}
#| label: wd-5-left-right-ex-2

# Lab 5 - Investigating the Witnesses
# Searching for Witness 1
person |> 
  filter(address_street_name == "Northwestern Dr") |>  # Find first witness
  slice_max(address_number) |> 
  left_join(y = interview,                             # Search for interview by person_id
            by = join_by(id == person_id)) |>          
  select(transcript)  |>                               # View interview transcript
  kable(col.names = "Clue #2")

# Searching for Witness 2
person |> 
  filter(address_street_name == "Franklin Ave",        # Find second witness
         str_detect(name,
                    pattern = "Annabel")) |> 
  left_join(y = interview,                             # Search for interview by person_id
            by = join_by(id == person_id)) |>          
  select(transcript)  |>                               # View interview transcript
  kable(col.names = "Clue #3")
```

-   `inner_join()` Example 1

```{r}
#| label: wd-5-inner-ex-1

# Lab 5 - Inspecting the Crime Scene (Revised for Portfolio)
get_fit_now_member |>
  filter(membership_status == "gold",                  # Find all gold members with a membership
         str_sub(id, start = 1, end = 3) == "48Z") |>  # number that start with 48Z
  inner_join(person,
            join_by(person_id == id, name)) |>         # Use person data to find associated license
  inner_join(drivers_license,                           # Use license data to find suspect with plate
            join_by(license_id == id))  |>             # number that includes "H42"
  filter(str_detect(plate_number,
                    pattern = "H42W")) |> 
  inner_join(get_fit_now_check_in,                      # Check that date matches statement from  
            join_by(id == membership_id)) |>           # second witness
  filter(ymd(check_in_date) == "2018-01-09") |> 
  inner_join(interview,                                     
            join_by(person_id)) |>                     # Retrieve suspect interview
  select(transcript)   |>                              # View interview transcript
  kable(col.names = "Clue #4")
```

-   `inner_join()` Example 2

```{r}
#| label: wd-5-inner-ex-2

# Lab 5 - Investigating the Witnesses (Revised for Portfolio)
person |> 
  filter(address_street_name == "Northwestern Dr" &
           address_number == max(address_number) |
         address_street_name == "Franklin Ave" &
           str_detect(name, pattern = "Annabel"))  |> 
  inner_join(y = interview,                             
             by = join_by(id == person_id)) |>          
  select(transcript)  |>                              
  kable(col.names = "Clue #2 & Clue #3")
```

**WD-6: I can use filtering joins to filter rows from a dataframe.**

-   `semi_join()`

```{r}
#| label: wd-6-semi

# Lab 3 Question 12 (Revised for Portfolio)

right_degrees <- tibble(academic_degree = c("prof","dr"))
                        
teacher_evals_clean |> 
  group_by(teacher_id, seniority, sex) |> 
  semi_join(right_degrees,
            by = join_by(academic_degree)) |> 
  summarize(resp_rate = mean(resp_share),
            .groups = "drop") |> 
  filter(resp_rate == max(resp_rate) | 
         resp_rate == min(resp_rate)) |>
  arrange(resp_rate) |>
  kable()
```

-   `anti_join()`

```{r}
#| label: wd-6-anti

# Lab 3 Question 12 (Revised for Portfolio)

wrong_degrees <- tibble(academic_degree = c("ma","no_dgr"))
                        
teacher_evals_clean |> 
  group_by(teacher_id, seniority, sex) |> 
  anti_join(wrong_degrees,
            by = join_by(academic_degree)) |> 
  summarize(resp_rate = mean(resp_share),
            .groups = "drop") |> 
  filter(resp_rate == max(resp_rate) | 
         resp_rate == min(resp_rate)) |>
  arrange(resp_rate) |>
  kable()
```

**WD-7: I can pivot dataframes from long to wide and visa versa**

-   `pivot_longer()`

```{r}
#| label: wd-7-long

# Lab 4 Revision Question 7
colors <- colorRampPalette(RColorBrewer::brewer.pal(7, "Accent"))(10) # color palette

ca_childcare |> 
  select(census_region,
         county_name,
         study_year,
         Infant = mc_infant,
         Toddler = mc_toddler,
         Preschool = mc_preschool) |> 
  pivot_longer(cols = c(Infant, Toddler, Preschool),
               names_to = "age_group",
               values_to = "median_price") |>
  mutate(age_group = fct(age_group,
                         levels = c("Infant", "Toddler", "Preschool")),
         census_region = fct_reorder2(.f = census_region,
                                     .x = study_year,
                                     .y = median_price,
                                     .desc = TRUE)) |> 
  ggplot(mapping = aes(x = study_year, y = median_price, color = census_region)) +
  geom_point(size = 0.5) +
  geom_smooth(linewidth = 0.5) +
  facet_wrap(vars(age_group)) +
  theme_bw() +
  theme(aspect.ratio = 1,
        axis.text.x = element_text(size = 6),
        axis.text.y = element_text(size = 6),
        title = element_text(size = 8),
        legend.title = element_text(size = 10),
        legend.key.size = unit(0.4, "cm")) +
  scale_x_continuous(n.breaks = 7) +
  scale_y_continuous(limits = c(100,500)) +
  scale_color_manual(values = colors,
                     labels = c("San Francisco Bay Area",
                                "Orange County",
                                "Los Angeles County",
                                "North San Joaquin Valley",
                                "Central Coast",
                                "Inland Empire",
                                "Superior California",
                                "South San Joaquin Valley",
                                "San Diego - Imperial",
                                "North Coast")) +
  labs(x = "Study Year",
       y = NULL,
       title = "Weekly Median Price for Center-Based Childcare ($)",
       color = "Calfornia Region") 
```

-   `pivot_wider()`

```{r}
#| label: wd-7-wide

# Lab 4 Question 5
ca_childcare |> 
  filter(study_year %in% c("2008", "2018")) |> 
  group_by(census_region, study_year)  |> 
  summarize(median_household_inc = median(mhi_2018),
            .groups = "drop") |> 
  pivot_wider(names_from = study_year,
              values_from = median_household_inc,
              names_prefix = "median_income_") |> 
  arrange(desc(median_income_2018))
```

## Reproducibility

**R-1: I can create professional looking, reproducible analyses using RStudio projects, Quarto documents, and the here package.**

The following assignments satisfy the above criteria:

-   Lab 2
-   Lab 3
-   Lab 5
-   Lab 7
-   Lab 9

**R-2: I can write well documented and tidy code.**

-   Example of **ggplot2** plotting

```{r}
#| label: r-2-1

# Challenge 4 Analysis (Revised for Portfolio)
childcare2018 |> 
  pivot_longer(cols = c("center_based_care","family_childcare"),
               names_to = "care_type",
               values_to = "price")  |>
  mutate(care_type = fct(care_type)) |> 
  ggplot(mapping = aes(x = price, y = age_group, fill = care_type)) +
  geom_boxplot(outliers = FALSE) +
  geom_jitter(mapping = aes(color = care_type),
              size = 0.75,
              alpha = 1,
              position = position_jitterdodge()) +
  theme_bw() +
  labs(x = NULL,
       y = NULL,
       title = "Center-Based Childcare: Significantly More Expensive",
       fill = "Type of Care") +
  guides(color = "none") +
  scale_color_manual(values = c("#96475D","#3C3E78")) +
  scale_fill_manual(values = c(family_childcare = "#BFC1FF", center_based_care = "#FFABC3"), 
                    limits = c("family_childcare", "center_based_care"),
                    labels = c("Family Childcare", "Center-Based Care")) +
  scale_x_continuous(labels = label_currency)
```

-   Example of **dplyr** pipeline

```{r}
#| label: r-2-2

# Lab 5 - Inspecting the Crime Scene (Revised for Portfolio)
get_fit_now_member |>
  filter(membership_status == "gold",                  # Find all gold members with a membership
         str_sub(id, start = 1, end = 3) == "48Z") |>  # number that start with 48Z
  left_join(person,
            join_by(person_id == id, name)) |>         # Use person data to find associated license
  left_join(drivers_license,                           # Use license data to find suspect with plate
            join_by(license_id == id))  |>             # number that includes "H42"
  filter(str_detect(plate_number,
                    pattern = "H42W")) |> 
  left_join(get_fit_now_check_in,                      # Check that date matches statement from  
            join_by(id == membership_id)) |>           # second witness
  filter(ymd(check_in_date) == "2018-01-09") |> 
  left_join(interview,                                     
            join_by(person_id)) |>                     # Retrieve suspect interview
  select(transcript)   |>                              # View interview transcript
  kable(col.names = "Clue #4")
```

-   Example of function formatting

```{r}
#| label: r-2-3

# Challenge 7 Question 2 Revisions
impossible_to_NA <- function(x, min, max) {
  
  stopifnot("Input vector is not numeric" = is.numeric(x),
            "Min is not a scalar value" =  is.numeric(min),
            "Min is not a scalar value" = length(min) == 1,
            "Max is not a scalar value" =  is.numeric(max),
            "Max is not a scalar value" = length(max) == 1,
            "Max is not greater than min" = max > min)
 
   case_when(x < min ~ NA,
             x > max ~ NA,
             .default = x)
   
}
```

**R-3: I can write robust programs that are resistant to changes in inputs.**

-   Example (any context)

```{r}
#| label: r-3-example

# Feedback: Is there a way you can get the max *and* min in **one** pipeline?
# Revision Reflection (for Q10, Q11, & Q12): I thought that the 
# best way to get the max and min values were to use the slice_min
# and slice_max functions. However, you cannot use both in one 
# pipeline. I learned that the min() and max() functions can be 
# used inside the filter function to output all of the observations
# equal to highest and lowest values in one pipeline. Doing so 
# allows me to print the ties and also reduce the number of objects
# in my code.

# Lab 3 - Question 12
teacher_evals_clean |> 
  group_by(teacher_id, seniority, sex) |> 
  filter(academic_degree %in% c("prof", "dr")) |> 
  summarize(resp_rate = mean(resp_share),
            .groups = "drop") |> 
  filter(resp_rate == max(resp_rate) | 
         resp_rate == min(resp_rate)) |>
  arrange(resp_rate) |>
  kable()
```

-   Example (function stops)

```{r}
#| label: r-3-function-stops

# Challenge 7 Question 2 Revisions
impossible_to_NA <- function(x, min, max) {
  
  stopifnot("Input vector is not numeric" = is.numeric(x),
            "Min is not a scalar value" =  is.numeric(min),
            "Min is not a scalar value" = length(min) == 1,
            "Max is not a scalar value" =  is.numeric(max),
            "Max is not a scalar value" = length(max) == 1,
            "Max is not greater than min" = max > min)
 
   case_when(x < min ~ NA,
             x > max ~ NA,
             .default = x)
}
```

## Data Visualization & Summarization

**DVS-1: I can create visualizations for a *variety* of variable types (e.g., numeric, character, factor, date)**

-   At least two numeric variables

```{r}
#| label: dvs-1-num

# Lab 4 Revisions Question 8
ca_childcare |> 
  ggplot(mapping = aes(x = mhi_2018, y = mc_infant)) +
  geom_point(size = 0.75) +
  geom_smooth(method = "lm") +
  theme_bw() +
  labs(x = "Median Household Income (in 2018 dollars)",
       y = NULL,
       title = "Median Weekly Price for Center-based Childcare for Infants in California") +
  scale_x_continuous(labels = label_currency()) +
  scale_y_continuous(labels = label_currency())
```

-   At least one numeric variable and one categorical variable

```{r}
#| label: dvs-2-num-cat

# Challenge 2 (Revised for Portfolio)
ggplot(data = surveys,
       mapping = aes(x = weight, y = species)) +
   geom_jitter(color = "darkslateblue", alpha = 0.5, size = 0.5) +
   geom_boxplot(outliers = FALSE, linewidth = 0.25, color = "gray10") +
   labs(x = "Weight (g)",
        y = "",
        subtitle = "Rodent Species",
        title = "Heaviest Portal, AZ Rodents: Abigula, Spectabilis, and Hispidus") +
   theme_bw() +
   theme(plot.title = element_text(face = "bold",                     # title formatting
                                   size = 15, 
                                   margin = margin(t = 10, b = 10)),
         axis.ticks = element_line(linewidth = 0.1),                  # axis label formatting
         axis.text = element_text(size = 7),
         panel.grid.major.y = element_line(linewidth = 0.1),          # remove y gridlines and border 
         panel.border = element_rect(linewidth = 0.25))

```

-   At least two categorical variables

```{r}
#| label: dvs-2-cat

# Challenge 4 Analysis (Revised for Portfolio)
childcare2018 |> 
  pivot_longer(cols = c("center_based_care","family_childcare"),
               names_to = "care_type",
               values_to = "price")  |>
  mutate(care_type = fct(care_type)) |> 
  ggplot(mapping = aes(x = price, y = age_group, fill = care_type)) +
  geom_boxplot(outliers = FALSE) +
  geom_jitter(mapping = aes(color = care_type),
              size = 0.75,
              alpha = 1,
              position = position_jitterdodge()) +
  theme_bw() +
  labs(x = NULL,
       y = NULL,
       title = "Center-Based Childcare: Significantly More Expensive",
       fill = "Type of Care") +
  guides(color = "none") +
  scale_color_manual(values = c("#96475D","#3C3E78")) +
  scale_fill_manual(values = c(family_childcare = "#BFC1FF", center_based_care = "#FFABC3"), 
                    limits = c("family_childcare", "center_based_care"),
                    labels = c("Family Childcare", "Center-Based Care")) +
  scale_x_continuous(labels = label_currency)
```

-   Dates (time series plot)

```{r}
#| label: dvs-2-date

# Challenge 7 Question 5
mycolors <- RColorBrewer::brewer.pal(8, "BrBG")[c(3,2,1,8)] # color palette
  
fish |> 
  mutate(condition = condition_index(length, weight)) |> 
  group_by(year, species) |> 
  summarize(mean_condition = mean(condition, na.rm = TRUE),
            .groups = "drop") |> 
  mutate(species = fct_reorder2(.f = species,
                               .x = year,
                               .y = mean_condition)) |> 
  ggplot(mapping = aes(x = year, y = mean_condition, color = species)) +
  geom_rug(sides = "b", color = "gray85", lineend = "round", length = unit(100, "npc")) +
  geom_smooth(se = FALSE) +
  geom_point() +
  theme_linedraw() +
  scale_color_manual(values = mycolors,
                     labels = c("Rainbow Trout",
                                "Brown Trout",
                                "Westslope Cutthroat Trout",
                                "Bull Trout")) +
  scale_x_continuous(breaks = seq(1988, 2007, by = 1)) +
  theme(axis.text.x = element_text(size = 7),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        plot.title = element_text(face = "bold"),
        plot.caption.position = "plot") +
  labs(title = "Bull Trout in Worse Condition than Other Fish",
       subtitle = "Mean Condition Index",
       x = "Year",
       y = NULL,
       color = "Trout Species",
       caption = "Black Foot River Fish in Helena, Montana")
```

**DVS-2: I use plot modifications to make my visualization clear to the reader.**

-   I can modify my plot theme to be more readable

```{r}
#| label: dvs-2-ex-1

# Challenge 7 Question 5
mycolors <- RColorBrewer::brewer.pal(8, "BrBG")[c(3,2,1,8)] # color palette
  
fish |> 
  mutate(condition = condition_index(length, weight)) |> 
  group_by(year, species) |> 
  summarize(mean_condition = mean(condition, na.rm = TRUE),
            .groups = "drop") |> 
  mutate(species = fct_reorder2(.f = species,
                               .x = year,
                               .y = mean_condition)) |> 
  ggplot(mapping = aes(x = year, y = mean_condition, color = species)) +
  geom_rug(sides = "b", color = "gray85", lineend = "round", length = unit(100, "npc")) +
  geom_smooth(se = FALSE) +
  geom_point() +
  theme_linedraw() +
  scale_color_manual(values = mycolors,
                     labels = c("Rainbow Trout",
                                "Brown Trout",
                                "Westslope Cutthroat Trout",
                                "Bull Trout")) +
  scale_x_continuous(breaks = seq(1988, 2007, by = 1)) +
  theme(axis.text.x = element_text(size = 7),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        plot.title = element_text(face = "bold"),
        plot.caption.position = "plot") +
  labs(title = "Bull Trout in Worse Condition than Other Fish",
       subtitle = "Mean Condition Index",
       x = "Year",
       y = NULL,
       color = "Trout Species",
       caption = "Black Foot River Fish in Helena, Montana")
```

-   I can modify my colors to be accessible to anyone's eyes

```{r}
#| label: dvs-2-ex-2

# Challenge 4 Analysis (Revised for Portfolio)
childcare2018 |> 
  pivot_longer(cols = c("center_based_care","family_childcare"),
               names_to = "care_type",
               values_to = "price")  |> 
  ggplot(mapping = aes(x = price, y = age_group, fill = care_type)) +
  geom_boxplot(outliers = FALSE) +
  geom_jitter(mapping = aes(color = care_type),                     
              size = 0.75,                                 
              position = position_jitterdodge()) + 
  theme_bw() +
  labs(x = NULL,
       y = NULL,
       title = "Median Weekly Price of California Childcare in 2018",
       fill = "Type of Care") +
  guides(color = "none") +
  scale_color_manual(values = c("#96475D","#3C3E78")) +
  scale_fill_manual(values = c("#FFABC3","#BFC1FF"), 
                    labels = c("Center Based Care", "Family Childcare")) +
  scale_x_continuous(labels = label_currency()) 

# color deficiency vision test shown in images
```

![](images/clipboard-2794975299.png){width="282"}

*Resource: Coloring for Colorblindness by David Nichols*

-   I can modify my plot titles to clearly communicate the data context

```{r}
#| label: dvs-2-ex-3

# Challenge 4 Analysis (Revised for Portfolio)
childcare2018 |> 
  pivot_longer(cols = c("center_based_care","family_childcare"),
               names_to = "care_type",
               values_to = "price")  |>
  mutate(care_type = fct(care_type)) |> 
  ggplot(mapping = aes(x = price, y = age_group, fill = care_type)) +
  geom_boxplot(outliers = FALSE) +
  geom_jitter(mapping = aes(color = care_type),
              size = 0.75,
              alpha = 1,
              position = position_jitterdodge()) +
  theme_bw() +
  labs(x = NULL,
       y = NULL,
       title = "Center-Based Childcare: Significantly More Expensive",
       fill = "Type of Care") +
  guides(color = "none") +
  scale_color_manual(values = c("#96475D","#3C3E78")) +
  scale_fill_manual(values = c(family_childcare = "#BFC1FF", center_based_care = "#FFABC3"), 
                    limits = c("family_childcare", "center_based_care"),
                    labels = c("Family Childcare", "Center-Based Care")) +
  scale_x_continuous(labels = label_currency())
```

-   I can modify the text in my plot to be more readable

```{r}
#| label: dvs-2-ex-4

# Challenge 2 (Revised for Portfolio)
ggplot(data = surveys,
       mapping = aes(x = weight, y = species)) +
   geom_jitter(color = "darkslateblue", alpha = 0.5, size = 0.5) +
   geom_boxplot(outliers = FALSE, linewidth = 0.25, color = "gray10") +
   labs(x = "Weight (g)",
        y = "",
        subtitle = "Rodent Species",
        title = "Heaviest Portal, AZ Rodents: Abigula, Spectabilis, and Hispidus") +
   theme_bw() +
   theme(plot.title = element_text(face = "bold",                     # title formatting
                                   size = 15, 
                                   margin = margin(t = 10, b = 10)),
         axis.ticks = element_line(linewidth = 0.1),                  # axis label formatting
         axis.text = element_text(size = 7),
         panel.grid.major.y = element_line(linewidth = 0.1),          # remove y gridlines and border 
         panel.border = element_rect(linewidth = 0.25))
```

-   I can reorder my legend to align with the colors in my plot

```{r}
#| label: dvs-2-ex-5

# Challenge 7 Question 5
mycolors <- RColorBrewer::brewer.pal(8, "BrBG")[c(3,2,1,8)] # color palette
  
fish |> 
  mutate(condition = condition_index(length, weight)) |> 
  group_by(year, species) |> 
  summarize(mean_condition = mean(condition, na.rm = TRUE),
            .groups = "drop") |> 
  mutate(species = fct_reorder2(.f = species,
                               .x = year,
                               .y = mean_condition)) |> 
  ggplot(mapping = aes(x = year, y = mean_condition, color = species)) +
  geom_rug(sides = "b", color = "gray85", lineend = "round", length = unit(100, "npc")) +
  geom_smooth(se = FALSE) +
  geom_point() +
  theme_linedraw() +
  scale_color_manual(values = mycolors,
                     labels = c("Rainbow Trout",
                                "Brown Trout",
                                "Westslope Cutthroat Trout",
                                "Bull Trout")) +
  scale_x_continuous(breaks = seq(1988, 2007, by = 1)) +
  theme(axis.text.x = element_text(size = 7),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        plot.title = element_text(face = "bold"),
        plot.caption.position = "plot") +
  labs(title = "Bull Trout in Worse Condition than Other Fish",
       subtitle = "Mean Condition Index",
       x = "Year",
       y = NULL,
       color = "Trout Species",
       caption = "Black Foot River Fish in Helena, Montana")
```

**DVS-3: I show creativity in my visualizations**

-   I can use non-standard colors (Example 1)

```{r}
#| label: dvs-3-1-ex-1

childcare2018 |> 
  pivot_longer(cols = c("center_based_care","family_childcare"),
               names_to = "care_type",
               values_to = "price")  |>
  mutate(care_type = fct(care_type)) |> 
  ggplot(mapping = aes(x = price, y = age_group, fill = care_type)) +
  geom_boxplot(outliers = FALSE) +
  geom_jitter(mapping = aes(color = care_type),
              size = 0.75,
              alpha = 1,
              position = position_jitterdodge()) +
  theme_bw() +
  labs(x = NULL,
       y = NULL,
       title = "Center-Based Childcare: Significantly More Expensive",
       fill = "Type of Care") +
  guides(color = "none") +
  scale_color_manual(values = c("#96475D","#3C3E78")) +
  scale_fill_manual(values = c(family_childcare = "#BFC1FF", center_based_care = "#FFABC3"), 
                    limits = c("family_childcare", "center_based_care"),
                    labels = c("Family Childcare", "Center-Based Care")) +
  scale_x_continuous(labels = label_currency())
```

-   I can use non-standard colors (Example 2)

```{r}
#| label: dvs-3-1-ex-2

# Challenge 7 Question 5
mycolors <- RColorBrewer::brewer.pal(8, "BrBG")[c(3,2,1,8)] # color palette
  
fish |> 
  mutate(condition = condition_index(length, weight)) |> 
  group_by(year, species) |> 
  summarize(mean_condition = mean(condition, na.rm = TRUE),
            .groups = "drop") |> 
  mutate(species = fct_reorder2(.f = species,
                               .x = year,
                               .y = mean_condition)) |> 
  ggplot(mapping = aes(x = year, y = mean_condition, color = species)) +
  geom_rug(sides = "b", color = "gray85", lineend = "round", length = unit(100, "npc")) +
  geom_smooth(se = FALSE) +
  geom_point() +
  theme_linedraw() +
  scale_color_manual(values = mycolors,
                     labels = c("Rainbow Trout",
                                "Brown Trout",
                                "Westslope Cutthroat Trout",
                                "Bull Trout")) +
  scale_x_continuous(breaks = seq(1988, 2007, by = 1)) +
  theme(axis.text.x = element_text(size = 7),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        plot.title = element_text(face = "bold"),
        plot.caption.position = "plot") +
  labs(title = "Bull Trout in Worse Condition than Other Fish",
       subtitle = "Mean Condition Index",
       x = "Year",
       y = NULL,
       color = "Trout Species",
       caption = "Black Foot River Fish in Helena, Montana")
```

-   I can use annotations (e.g., `geom_text()`)

```{r}
#| label: dvs-3-2

# Lab 10 Question 3
results |> 
  enframe(name = "simulation",
          value = "correct_number") |> 
  count(correct_number) |> 
  mutate(prop = n / 10000,
         correct_number = as.factor(correct_number)) |> 
  select(correct_number, prop) |> 
  ggplot(mapping = aes(x = correct_number, y = prop, fill = correct_number)) +
  geom_bar(stat = "identity") +
  geom_text(mapping = aes(label = str_c(prop*100, "%")), vjust = -0.5, size = 3) +
  theme_minimal() +
  labs(title = "So Many Wrong Babies!",
       subtitle = "Distribution of Correctly Returned Babies for 4 Births",
       y = NULL,
       x = "Correct Babies",
       caption = "10,000 simulations of Random Babies Simulation") +
  scale_y_continuous(labels = scales::label_percent()) +
  scale_fill_manual(values = RColorBrewer::brewer.pal(4, "Pastel2")) +
  theme(legend.position = "none",
        title = element_text(face = "bold"),
        panel.grid.major.x = element_blank())
```

-   I can choose creative geometries (e.g., `geom_segment()`, `geom_ribbon)()`)

```{r}
#| label: dvs-3-3

# Lab 10 Question 13
set.seed(14)

ci_data |> 
  slice_sample(n = 100) |> 
  mutate(iteration = row_number(),
         cover = as.factor(cover)) |> 
  ggplot() +
  geom_segment(mapping = aes(x = conf.low, 
                             y = iteration, 
                             xend = conf.high, 
                             color = cover)) +
  geom_vline(mapping = aes(xintercept = 0.5), linetype = "dotted") +
  annotate("text", 
           x = 0.5,
           y = 105,
           label = "Population Slope = 0.5", 
           hjust = -0.05, 
           size = 3) +
  theme_minimal() +
  labs(title = "95% Confidence Intervals of Estimated Regression Slope",
       x = "Slope Coefficient Estimate",
       y = NULL,
       subtitle = "<span style='color:#ED3B18;'> Red</span> =
                   Does Not Capture Population Slope",
       caption = "Constructed from 100 Simulated Data Sets") +
  theme(axis.text.y = element_blank(),
        legend.position = "none",
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        plot.subtitle = ggtext::element_markdown()) +
  scale_color_manual(values = RColorBrewer::brewer.pal(3, "Set1"))
```

**DVS-4: I can calculate numerical summaries of variables.**

-   Example using `summarize()`

```{r}
#| label: dvs-4-summarize

# Lab 3 Question 5
teacher_evals_clean |> 
  summarize(unique_instructors = n_distinct(teacher_id),
            unique_courses = n_distinct(course_id))
```

-   Example using `across()`

```{r}
#| label: dvs-4-across

# Lab 3 Question 6 (Revised for Portfolio)
teacher_evals_clean |> 
  summarize(across(.cols = c(teacher_id, course_id),
                   .fns = ~ n_distinct(.x))) |> 
  kable(col.names = c("Unique Instructors", "Unique Courses"))
```

**DVS-5: I can find summaries of variables across multiple groups.**

-   Example 1

```{r}
#| label: dvs-5-1

# Lab 3 Question 9
teacher_evals_clean |> 
  group_by(course_id, teacher_id) |> 
  summarize(num_question = n_distinct(question_no),
            .groups = "drop") |> 
  filter(num_question == 9)
```

-   Example 2

```{r}
#| label: dvs-5-2

# Lab 4 Question 6
ca_childcare |> 
  filter(study_year == 2018) |> 
  group_by(census_region, study_year) |> 
  summarize(median_mc_infant = median(mc_infant),
            .groups = "drop") |> 
  slice_min(median_mc_infant)
```

**DVS-6: I can create tables which make my summaries clear to the reader.**

-   I can modify my column names to clearly communicate the data context

```{r}
#| label: dvs-6-ex-1

fish |> 
  map_int(.f = ~ sum(is.na(.x))) |> 
  enframe(name = "variable", 
          value = "missing_values") |> 
  arrange(desc(missing_values)) |> 
  gt() |> 
  cols_label(variable = md("**Measurement Variable**"), 
             missing_values = md("**Missing Values**")) |> 
  data_color(columns = missing_values, 
             rows = missing_values > 0,
             method = "numeric",
             palette = c("salmon3")) |> 
  data_color(columns = missing_values, 
             rows = missing_values == 0,
             method = "numeric",
             palette = c("honeydew4")) |> 
  data_color(columns = variable,
             method = "factor",
             palette = c("gray60")) |> 
  tab_style(style = list(cell_fill(color = "gray30"), 
                         cell_text(color = "white", 
                                   align = "center")),
            locations = cells_column_labels()) |> 
  tab_header(title = md("**Missing Measurements of River Trout Population**"),
             subtitle = "Data on Blackfoot River Trout in Helena, Montana") |> 
  tab_style(style = list(cell_fill(color = "gray20"), cell_text(color = "white")),
            locations = cells_title())
```

-   I can modify the text in my table to be more readable (e.g., bold face for column headers)

```{r}
#| label: dvs-6-ex-2

# Lab 9 Question 8
fish |> 
  map_int(.f = ~ sum(is.na(.x))) |> 
  enframe(name = "variable", 
          value = "missing_values") |> 
  arrange(desc(missing_values)) |> 
  gt() |> 
  cols_label(variable = md("**Measurement Variable**"), 
             missing_values = md("**Missing Values**")) |> 
  data_color(columns = missing_values, 
             rows = missing_values > 0,
             method = "numeric",
             palette = c("salmon3")) |> 
  data_color(columns = missing_values, 
             rows = missing_values == 0,
             method = "numeric",
             palette = c("honeydew4")) |> 
  data_color(columns = variable,
             method = "factor",
             palette = c("gray60")) |> 
  tab_style(style = list(cell_fill(color = "gray30"), 
                         cell_text(color = "white", 
                                   align = "center")),
            locations = cells_column_labels()) |> 
  tab_header(title = md("**Missing Measurements of River Trout Population**"),
             subtitle = "Data on Blackfoot River Trout in Helena, Montana") |> 
  tab_style(style = list(cell_fill(color = "gray20"), cell_text(color = "white")),
            locations = cells_title())
```

-   I can arrange my table to have an intuitive ordering

```{r}
#| label: dvs-6-ex-3

# Lab 9 Question 8
fish |> 
  map_int(.f = ~ sum(is.na(.x))) |> 
  enframe(name = "variable", 
          value = "missing_values") |> 
  arrange(desc(missing_values)) |> 
  gt() |> 
  cols_label(variable = md("**Measurement Variable**"), 
             missing_values = md("**Missing Values**")) |> 
  data_color(columns = missing_values, 
             rows = missing_values > 0,
             method = "numeric",
             palette = c("salmon3")) |> 
  data_color(columns = missing_values, 
             rows = missing_values == 0,
             method = "numeric",
             palette = c("honeydew4")) |> 
  data_color(columns = variable,
             method = "factor",
             palette = c("gray60")) |> 
  tab_style(style = list(cell_fill(color = "gray30"), 
                         cell_text(color = "white", 
                                   align = "center")),
            locations = cells_column_labels()) |> 
  tab_header(title = md("**Missing Measurements of River Trout Population**"),
             subtitle = "Data on Blackfoot River Trout in Helena, Montana") |> 
  tab_style(style = list(cell_fill(color = "gray20"), cell_text(color = "white")),
            locations = cells_title())
```

**DVS-7: I show creativity in my tables.**

-   I can use non-default colors

```{r}
#| label: dvs-7-ex-1

# Lab 9 Question 8
fish |> 
  map_int(.f = ~ sum(is.na(.x))) |> 
  enframe(name = "variable", 
          value = "missing_values") |> 
  arrange(desc(missing_values)) |> 
  gt() |> 
  cols_label(variable = md("**Measurement Variable**"), 
             missing_values = md("**Missing Values**")) |> 
  data_color(columns = missing_values, 
             rows = missing_values > 0,
             method = "numeric",
             palette = c("salmon3")) |> 
  data_color(columns = missing_values, 
             rows = missing_values == 0,
             method = "numeric",
             palette = c("honeydew4")) |> 
  data_color(columns = variable,
             method = "factor",
             palette = c("gray60")) |> 
  tab_style(style = list(cell_fill(color = "gray30"), 
                         cell_text(color = "white", 
                                   align = "center")),
            locations = cells_column_labels()) |> 
  tab_header(title = md("**Missing Measurements of River Trout Population**"),
             subtitle = "Data on Blackfoot River Trout in Helena, Montana") |> 
  tab_style(style = list(cell_fill(color = "gray20"), cell_text(color = "white")),
            locations = cells_title())
```

-   I can modify the layout of my table to be more readable (e.g., `pivot_longer()` or `pivot_wider()`)

```{r}
#| label: dvs-7-ex-2

# Lab 4 Revisions Question 5 (Revised for Portfolio)
ca_childcare |> 
  filter(study_year %in% c("2008", "2018")) |> 
  group_by(census_region, study_year)  |> 
  summarize(median_household_inc = median(mhi_2018),
            .groups = "drop") |> 
  pivot_wider(names_from = study_year,
              values_from = median_household_inc,
              names_prefix = "median_income_") |> 
  arrange(desc(median_income_2018)) |> 
  kable(col.names = c("Census Region", "Median Income in 2008", "Median Income in 2018"))
```

## Program Efficiency

**PE-1: I can write concise code which does not repeat itself.**

-   using a single function call with multiple inputs (rather than multiple function calls)

```{r}
#| label: pe-1-one-call

# Lab 3 Question 10

# Feedback: Do you want to filter your groups? You should only call 
# the filter() function once!
# Revision Reflection: Initially, I had two separate filter functions
# for the question number and the instructors. I realize now that it 
# would be more efficient to just use one filter function and input two
# arguments to only call the function one time.

teacher_evals_clean |> 
  group_by(teacher_id) |> 
  filter(n() >= 5,
         question_no == 901) |> 
  summarize(Q1_avg_rating = mean(SET_score_avg)) |> 
  filter(Q1_avg_rating == max(Q1_avg_rating) | 
         Q1_avg_rating == min(Q1_avg_rating)) |>
  arrange(Q1_avg_rating) |> 
  kable()
```

-   using `across()`

```{r}
#| label: pe-1-across

# Lab 7 Question 2
fish |> 
  summarize(across(.cols = trip:species,
                   .fns = ~ sum(is.na(.x)))) |>  
  pivot_longer(cols = trip:species,
               names_to = "variable",
               values_to = "missing") |> 
  kable(col.names = c("Variable", "Missing Values"))
```

-   using functions from the `map()` family

```{r}
#| label: pe-1-map-1

# Lab 9 Question 3
surveys |> 
  map_chr(.f = ~ class(.x)) |> 
  enframe(name = "variable",
          value = "data_type") |> 
  arrange(desc(data_type)) |> 
  mutate(data_type = str_to_title(data_type)) |>
  gt(groupname_col = "data_type",
     row_group_as_column = TRUE) |> 
  cols_label(variable = md("**Variable**")) |> 
  tab_header(title = md("**Types of Variables**"),
             subtitle = "Portal, AZ Rodents Data Set") |> 
  tab_stubhead(label = md("**Data Type**")) |> 
  tab_style(style = cell_text(align = "center"),
            location = cells_column_labels())
```

**PE-2: I can write functions to reduce repetition in my code.**

-   Example 1: Function that operates on vectors

```{r}
#| label: pe-2-1

# Challenge 7 Question 2 Revisions
impossible_to_NA <- function(x, min, max) {
  
  stopifnot("Input vector is not numeric" = is.numeric(x),
            "Min is not a scalar value" =  is.numeric(min),
            "Min is not a scalar value" = length(min) == 1,
            "Max is not a scalar value" =  is.numeric(max),
            "Max is not a scalar value" = length(max) == 1,
            "Max is not greater than min" = max > min)
 
   case_when(x < min ~ NA,
             x > max ~ NA,
             .default = x)
}
```

-   Example 2: Function that operates on data frames

```{r}
#| label: pe-2-2

# Lab 8 Question 3 Revisions

# helper function for labels for variables of form "variable_unit"
make_unit_titles <- function(var) {

  var_unit <- var |>
    str_replace_all(pattern = "_", replace = " ") |>
    str_sub(start = str_length(var) - 1, 
            end = str_length(var)) |>
    str_trim()

  var_unit_formatted <- var_unit |> 
    str_pad(pad = "(", 
            width = str_length(var_unit) + 1, 
            side = "left") |>
    str_pad(pad = ")", 
            width = str_length(var_unit) + 2, 
            side = "right")
  
  var |>
    str_replace_all(pattern = "_", replace = " ") |>
    str_sub(end = str_length(var) - 2) |>
    str_to_title() |>
    str_trim() |> 
    str_c(var_unit_formatted, sep = " ")
}

# plot function
two_way_interaction_plot <- function(df, factorA, factorB, response) {
  
  stopifnot("df must be a data frame" = is.data.frame(df))
  
  # create nice labels for plot
  factorA_label <- as_label(enquo(factorA))
  factorB_label <- as_label(enquo(factorB))
  response_label <- as_label(enquo(response))
  if (str_detect(response_label, 
                 pattern = "(cm)|(mm)|(km)|(g)|(kg)")) {
    response_label <- make_unit_titles(response_label)
  } else {
    response_label <- str_to_title(response_label)
  }
  if (str_detect(factorA_label, 
                 pattern = "(cm)|(mm)|(km)|(g)|(kg)")) {
    factorA_label <- make_unit_titles(factorA_label)
  } else {
    factorA_label <- str_to_title(factorA_label)
  }
  if (str_detect(factorB_label, 
                 pattern = "(cm)|(mm)|(km)|(g)|(kg)")) {
    factorB_label <- make_unit_titles(factorB_label)
  } else {
    factorB_label <- str_to_title(factorB_label)
  }
  
  title_text <- str_c(factorA_label, 
                      "x", 
                      factorB_label,
                      "Interaction Effect",
                      sep = " ")
  
  df |> 
    # data wrangling
    group_by({{ factorA }}, {{ factorB }}) |>
    summarize(group_mean = mean({{ response }}, na.rm = TRUE), 
              .groups = "drop") |>
    mutate({{ factorA }} := str_to_title({{ factorA }}),
           {{ factorB }} := str_to_title({{ factorB }}),
           {{ factorB }} := fct_reorder2(.f = {{ factorB }},
                                         .x = {{ factorA }},
                                         .y = group_mean,
                                         .desc = TRUE,
                                         .na_rm = FALSE)) |> 
    # plot
    ggplot(mapping = aes(x = {{ factorA }},
                         y = group_mean, 
                         color = {{ factorB }},
                         shape = {{ factorB }})) +
    geom_point(size = 3, na.rm = TRUE) +
    geom_line(mapping = aes(group = {{ factorB }})) +
    theme_light() +
    labs(title = title_text,
         x = factorA_label,
         y = NULL,
         subtitle = str_c("Mean", response_label, sep = " "),
         color = factorB_label) +
    theme(title = element_text(face = "bold")) +
    guides(color = guide_legend(factorB_label),
           shape = guide_legend(factorB_label))
}
```

-   Example 3: Function that operates on vectors *or* data frames

```{r}
#| label: pe-2-3

# Lab 8 Question 2
pivot_table <- function(df, col, row) {
  stopifnot("df must be a data frame" = is.data.frame(df))
  
  df |>
  count({{ col }}, {{ row }}) |>
  pivot_wider(names_from = {{ col }},
              values_from = n,
              values_fill = 0) |> 
  janitor::adorn_totals(where = c("row","col"))
}
```

**PE-3: I can use iteration to reduce repetition in my code.**

-   using `across()`

```{r}
#| label: pe-3-across

# Lab 3 Question 5
teacher_evals_clean <- teacher_evals |>
  rename(sex = gender) |>
  filter(no_participants > 10) |>
  mutate(across(.cols = c(teacher_id, question_no, academic_degree, sex),
                .fns = ~ as.factor(.x))) |>
  select(course_id,
         teacher_id,
         question_no,
         no_participants,
         resp_share,
         SET_score_avg,
         percent_failed_cur,
         academic_degree,
         seniority,
         sex)
```

-   using a `map()` function with **one** input (e.g., `map()`, `map_chr()`, `map_dbl()`, etc.) (Example 1)

```{r}
#| label: pe-3-map-1

# Lab 9 Question 6
evals |>
  map_if(.p = is.character, .f = ~ as.factor(.x)) |> 
  bind_cols() |>
  select(teacher_id, academic_degree, seniority, sex) |> 
  distinct(teacher_id, .keep_all = TRUE) |> 
  mutate(sen_level = case_when(seniority <= 4  ~ "Junior",
                               seniority > 4   ~ "Senior"),
         sen_level = as.factor(sen_level),
         academic_degree = fct_recode(.f = academic_degree,
                                      "No Degree" = "no_dgr",
                                      "Masters" = "ma",
                                      "Doctorate" = "dr",
                                      "Tenured Professor" = "prof"),
         academic_degree = fct_relevel(.f = academic_degree,
                                      "No Degree",
                                      "Masters",
                                      "Doctorate",
                                      "Tenured Professor"),
         sex = fct_recode(.f = sex,
                          "Male" = "male",
                          "Female" = "female")) |> 
  select(academic_degree, sex, sen_level) |> 
  pivot_longer(cols = c("academic_degree", "sex", "sen_level"),
                     names_to = "variable",
                     values_to = "level") |> 
  count(variable, level) |> 
  group_by(variable) |>
  mutate(prop = n / sum(n)) |> 
  ungroup() |>
  mutate(variable = fct_recode(.f = variable,
                               "Academic Degree" = "academic_degree",
                               "Seniority" = "sen_level",
                               "Sex" = "sex")) |>
  gt(groupname_col = "variable") |> 
  tab_style(style = cell_fill(color = "#F2F2FC"),
            locations = cells_row_groups()) |> 
  tab_style(style = cell_text(weight = "bold"),
            locations = cells_row_groups()) |> 
  tab_header(title = md("**Instructor Demographics**"),
             subtitle = "2020 Student Evaluations of Teaching 
                         from the University of Poland") |>
  tab_style(style = cell_fill(color = "#EDEDFF"),
            locations = cells_title()) |> 
  cols_label(level = md("**Demographic**"),
             n = md("**Count**"),
             prop = md("**%**")) |> 
  tab_spanner(label = md("**Instructors**"),
              columns = c(n, prop)) |> 
  cols_align(align = "left", columns = "level") |> 
  fmt_percent(prop, decimals = 1)
```

-   using a `map()` function with **one** input (e.g., `map()`, `map_chr()`, `map_dbl()`, etc.) (Example 2)

```{r}
#| label: pe-3-map-2

# Lab 9 Question 8
fish |> 
  map_int(.f = ~ sum(is.na(.x))) |> 
  enframe(name = "variable", 
          value = "missing_values") |> 
  arrange(desc(missing_values)) |> 
  gt() |> 
  cols_label(variable = md("**Measurement Variable**"), 
             missing_values = md("**Missing Values**")) |> 
  data_color(columns = missing_values, 
             rows = missing_values > 0,
             method = "numeric",
             palette = c("salmon3")) |> 
  data_color(columns = missing_values, 
             rows = missing_values == 0,
             method = "numeric",
             palette = c("honeydew4")) |> 
  data_color(columns = variable,
             method = "factor",
             palette = c("gray60")) |> 
  tab_style(style = list(cell_fill(color = "gray30"), 
                         cell_text(color = "white", 
                                   align = "center")),
            locations = cells_column_labels()) |> 
  tab_header(title = md("**Missing Measurements of River Trout Population**"),
             subtitle = "Data on Blackfoot River Trout in Helena, Montana") |> 
  tab_style(style = list(cell_fill(color = "gray20"), cell_text(color = "white")),
            locations = cells_title())
```

**PE-4: I can use modern tools when carrying out my analysis.**

-   I can use functions which are not superseded or deprecated

```{r}
#| label: pe-4-1

# using label_currency() instead of dollar()

# Lab 4 Revisions Question 8
ca_childcare |> 
  ggplot(mapping = aes(x = mhi_2018, y = mc_infant)) +
  geom_point(size = 0.75) +
  geom_smooth(method = "lm") +
  theme_bw() +
  labs(x = "Median Household Income (in 2018 dollars)",
       y = NULL,
       title = "Median Weekly Price for Center-based Childcare for Infants in California") +
  scale_x_continuous(labels = label_currency()) +
  scale_y_continuous(labels = label_currency())
```

-   I can connect a data wrangling pipeline into a `ggplot()`

```{r}
#| label: pe-4-2

# Lab 4 Revisions Question 7

colors <- colorRampPalette(RColorBrewer::brewer.pal(7, "Accent"))(10)  # color palette

ca_childcare |> 
  select(census_region,
         county_name,
         study_year,
         Infant = mc_infant,
         Toddler = mc_toddler,
         Preschool = mc_preschool) |> 
  pivot_longer(cols = c(Infant, Toddler, Preschool),
               names_to = "age_group",
               values_to = "median_price") |>
  mutate(age_group = fct(age_group,
                         levels = c("Infant", "Toddler", "Preschool")),
         census_region = fct_reorder2(.f = census_region,
                                     .x = study_year,
                                     .y = median_price,
                                     .desc = TRUE)) |> 
  ggplot(mapping = aes(x = study_year, y = median_price, color = census_region)) +
  geom_point(size = 0.5) +
  geom_smooth(linewidth = 0.5) +
  facet_wrap(vars(age_group)) +
  theme_bw() +
  theme(aspect.ratio = 1,
        axis.text.x = element_text(size = 6),
        axis.text.y = element_text(size = 6),
        title = element_text(size = 8),
        legend.title = element_text(size = 10),
        legend.key.size = unit(0.4, "cm")) +
  scale_x_continuous(n.breaks = 7) +
  scale_y_continuous(limits = c(100,500)) +
  scale_color_manual(values = colors,
                     labels = c("San Francisco Bay Area",
                                "Orange County",
                                "Los Angeles County",
                                "North San Joaquin Valley",
                                "Central Coast",
                                "Inland Empire",
                                "Superior California",
                                "South San Joaquin Valley",
                                "San Diego - Imperial",
                                "North Coast")) +
  labs(x = "Study Year",
       y = NULL,
       title = "Weekly Median Price for Center-Based Childcare ($)",
       color = "Calfornia Region") 
```

## Data Simulation & Statistical Models

**DSSM-1: I can simulate data from a *variety* of probability models.**

-   Example 1

```{r}
#| label: dsm-1-1

# Lab 10 Question 1

randomBabies <- function(n_babies){
  
  stopifnot("input must be a scalar value" = is.numeric(n_babies),
            "input must be a scalar value" = length(n_babies) == 1)
  
  tibble(baby = 1:n_babies,
         parent = sample(1:n_babies,
                         size = n_babies,
                         replace = FALSE)) |> 
    filter(baby == parent) |> 
    nrow()
}

set.seed(1)

results <- map_int(.x = 1:10000,
                   .f = ~ randomBabies(n_babies = 4))
```

-   Example 2

```{r}
#| label: dsm-1-2

# Lab 10 Question 8
mycifun <- function(beta0, beta1, n) {
  
# define slope and intercept parameters
intercept = beta0
slope = beta1

# generate x vector
x <- runif(n = n, min = 0, max = 1)

# generate noise `ep` vector
ep <- rnorm(n = n, mean = 0, sd = 1)

# generate outcome from population model
y = intercept + x*slope + ep 

# create an "observed data" dataframe with only the x and y vectors
observed_data <- tibble(x, y)

tidy(lm(y ~ x, data = observed_data),
     conf.int = TRUE,
     conf.level = 0.95) |> 
  filter(term == "x") |> 
  select(estimate, conf.low, conf.high) |> 
  mutate(cover = if_else(conf.low < beta1 && conf.high > beta1, 
                         1, 
                         0))
}
```

**DSSM-2: I can conduct common statistical analyses in R.**

-   Example 1

```{r}
#| label: dsm-2-1

# Challenge 3 Question 3
chisq.test(teacher_evals_compare$sen_level, teacher_evals_compare$SET_level)
```

-   Example 2

```{r}
#| label: dsm-2-2

# Lab 4 Question 9 (Revised for Portfolio)
lm(mc_infant ~ mhi_2018, data = ca_childcare) |> 
  summary()
```

-   Example 3

```{r}
#| label: dsm-2-3

# Lab 2 Question 17 (Revised for Portfolio)
aov(weight ~ species, data = surveys) |> 
  summary()
```

## Revising My Thinking

Throughout the course, I revised my thinking mostly through reducing inefficiencies in my code and improving readability in my work. After receiving feedback in Lab 3 about calling functions only once, I used a single filter statement with multiple arguments in multiple areas in Lab 5. Additionally, in Lab 3, I was also challenged to get find the minimum and maximum values of a variable in a table in a single pipeline. By revising my thinking on the slice() functions, I learned when the slice_max() and slice_min() variables might not be the best tools for certain situations. By exploring other options, I was able to reduce the number of objects in my code and completed Lab 5 without using any unnecessary objects.

In the later half of the quarter, I revised my thinking through how I viewed function stops. Initially, I thought that function stops were optional and didn't include any, but after some feedback, I realized that function stops are a great way to reduce code errors and improve the robustness of my code.

## Extending My Thinking

The best example of how I have extended my thinking throughout this course is the use of the kable() to display information. After learning about the function to display long tables in Lab 3, I have been expanding on how I use this function to add creativity to my tables. By changing column names and adding table titles in Challenge 4 and using kable() to display clues throughout Lab 5, I believe that I have shown to apply previous course content to future assignments in way that gives my analyses a professional and creative touch.

Lab 8 and Lab 9 are great examples of how I have used the skills and concepts I learned from previous labs to create well-designed graphs. I am proud of how I have been able to weave context into the titles and captions of my graph while also focusing on how to incorporate readability into my graph by reordering my legends and using creative colors.

## Peer Support & Collaboration

A peer review that I am particularly proud of was for Lab 3. I wrote:

"Hello ! For your feedback, I'd like to highlight how you added newlines in code lines with too many characters to prevent them from becoming too long as I thought this was good practice. I believe you could consider adding new line after every comma for very long lists, so that the lines can be read as a vertical list.\
In your functions, I saw that you used named arguments most of the time, but saw that some were missing in your if_any() function.\
I would also like to see more consistency in put spaces after commas in a list, but the code overall is fairly tidy. Nice work!"

I believe that this review has good components of a constructive peer review. I highlight areas in which he demonstrates good practice and point out areas of improvement. I also explain how these changes can improve the readability of their code.

Through our weekly peer programming activities, I have learned how to verbally share my thought process and also give others space to share theirs. For example, when acting as Computer, I refuse to talk while it seems like the Coder is thinking. Only after they express an idea, I start to ask questions about their ideas. In doing so, I had the opportunity to hear about my classmates' thought processes and different ways we can approach a problem.

On Discord, I have been able to share a few questions publicly that I hope my peers have been able to benefit from seeing. As I have had some of my own problems solved by others sharing their questions, I was happy to use the Discord to share the questions I had.

![](images/clipboard-3260774400.png){width="471" height="50"}

![](images/clipboard-53865351.png){width="470" height="51"}

![](images/clipboard-2645290418.png){width="470"}
